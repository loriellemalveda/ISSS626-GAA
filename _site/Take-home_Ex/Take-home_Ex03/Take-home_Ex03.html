<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lorielle Malveda">
<meta name="dcterms.date" content="2024-11-02">

<title>Take-Home Exercise 3b: Predicting HDB Resale Prices with Geographically Weighted Machine Learning Methods – ISSS626-GAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01_01/Hands-on_Ex01_01.html">
 <span class="dropdown-text">Hands-on Exercise 1: Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01_02/Hands-on_Ex01_02.html">
 <span class="dropdown-text">Hands-on Exercise 1: Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02_01/Hands-on_Ex02_01.html">
 <span class="dropdown-text">Hands-on Exercise 2: Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02_02/Hands-on_Ex02_02.html">
 <span class="dropdown-text">Hands-on Exercise 2: Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05_01/Hands-on_Ex05_01.html">
 <span class="dropdown-text">Hands-on Exercise 5: Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05_02/Hands-on_Ex05_02.html">
 <span class="dropdown-text">Hands-on Exercise 5: Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10_01/Hands-on_Ex10_01.html">
 <span class="dropdown-text">Hands-on Exercise 10: Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10_02/Hands-on_Ex10_02.html">
 <span class="dropdown-text">Hands-on Exercise 10: Part 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01/In-class_Ex01.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html">
 <span class="dropdown-text">In-class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html">
 <span class="dropdown-text">In-class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex10/In-class_Ex10.html">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1. OVERVIEW</a></li>
  <li><a href="#the-task" id="toc-the-task" class="nav-link" data-scroll-target="#the-task">2. THE TASK</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">3. THE DATA</a></li>
  <li><a href="#geospatial-data-wrangling" id="toc-geospatial-data-wrangling" class="nav-link" data-scroll-target="#geospatial-data-wrangling">4. GEOSPATIAL DATA WRANGLING</a>
  <ul class="collapse">
  <li><a href="#installing-the-r-packages" id="toc-installing-the-r-packages" class="nav-link" data-scroll-target="#installing-the-r-packages">4.1 INSTALLING THE R PACKAGES</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">4.2 Loading the Data</a></li>
  <li><a href="#getting-coordinates" id="toc-getting-coordinates" class="nav-link" data-scroll-target="#getting-coordinates">4.3 Getting Coordinates</a></li>
  <li><a href="#filtering-within-boundaries" id="toc-filtering-within-boundaries" class="nav-link" data-scroll-target="#filtering-within-boundaries">4.4 Filtering Within Boundaries</a></li>
  <li><a href="#adding-derived-variables---from-other-sources" id="toc-adding-derived-variables---from-other-sources" class="nav-link" data-scroll-target="#adding-derived-variables---from-other-sources">4.5 ADDING DERIVED VARIABLES - from other sources</a></li>
  <li><a href="#derived-variables-from-the-original-dataset" id="toc-derived-variables-from-the-original-dataset" class="nav-link" data-scroll-target="#derived-variables-from-the-original-dataset">4.6 Derived Variables From the Original Dataset</a></li>
  <li><a href="#plotting-the-variables" id="toc-plotting-the-variables" class="nav-link" data-scroll-target="#plotting-the-variables">4.7 PLOTTING THE VARIABLES</a></li>
  <li><a href="#log-transformation" id="toc-log-transformation" class="nav-link" data-scroll-target="#log-transformation">4.8 LOG TRANSFORMATION</a></li>
  <li><a href="#correlation-matrix" id="toc-correlation-matrix" class="nav-link" data-scroll-target="#correlation-matrix">4.7 CORRELATION MATRIX</a></li>
  </ul></li>
  <li><a href="#splitting-to-training-and-test-dataset" id="toc-splitting-to-training-and-test-dataset" class="nav-link" data-scroll-target="#splitting-to-training-and-test-dataset">5. SPLITTING TO TRAINING AND TEST DATASET</a>
  <ul class="collapse">
  <li><a href="#non-spatial-linear-regression" id="toc-non-spatial-linear-regression" class="nav-link" data-scroll-target="#non-spatial-linear-regression">5.1 Non-Spatial Linear Regression</a></li>
  </ul></li>
  <li><a href="#geographically-weighted-regression" id="toc-geographically-weighted-regression" class="nav-link" data-scroll-target="#geographically-weighted-regression">6. GEOGRAPHICALLY WEIGHTED REGRESSION</a>
  <ul class="collapse">
  <li><a href="#variation-inflation-factor" id="toc-variation-inflation-factor" class="nav-link" data-scroll-target="#variation-inflation-factor">6.1 Variation Inflation Factor</a></li>
  <li><a href="#calculation-the-adaptive-bandwidth" id="toc-calculation-the-adaptive-bandwidth" class="nav-link" data-scroll-target="#calculation-the-adaptive-bandwidth">6.2 Calculation the Adaptive Bandwidth</a></li>
  <li><a href="#calculating-the-gwr" id="toc-calculating-the-gwr" class="nav-link" data-scroll-target="#calculating-the-gwr">6.3 Calculating the GWR</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">6.4 Testing</a></li>
  <li><a href="#gwr---test-data" id="toc-gwr---test-data" class="nav-link" data-scroll-target="#gwr---test-data">6.5 GWR - Test Data</a>
  <ul class="collapse">
  <li><a href="#comparing-actual-values-to-predicted-values-using-a-scatterplot" id="toc-comparing-actual-values-to-predicted-values-using-a-scatterplot" class="nav-link" data-scroll-target="#comparing-actual-values-to-predicted-values-using-a-scatterplot">COMPARING ACTUAL VALUES TO PREDICTED VALUES USING A SCATTERPLOT</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-Home Exercise 3b: Predicting HDB Resale Prices with Geographically Weighted Machine Learning Methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lorielle Malveda </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 2, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 10, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>1. OVERVIEW</h1>
<p>Housing is a key part of wealth for households around the world, with buying a home often being one of the biggest investments people make. Housing prices are influenced by many factors, including broader economic ones like inflation and local factors specific to the property, such as its size or location near services like schools and shopping centers. Traditionally, price prediction models use a method called Ordinary Least Squares (OLS), but this approach doesn’t account for the geographical patterns in housing data, which can lead to inaccurate results.</p>
<p>To improve accuracy, we will introduce Geographically Weighted Models (GWMs) to better predict housing prices by considering these location-based differences.</p>
</section>
<section id="the-task" class="level1">
<h1>2. THE TASK</h1>
<p>For this exercise, we will tackle building a predictive model to forecast HDB resale prices for the period of July to September 2024, using transaction records from HDB resale data in 2023.</p>
</section>
<section id="the-data" class="level1">
<h1>3. THE DATA</h1>
<p>For this Take-Home Exercise,we are going to use the <em>HDB Resale Flat Prices</em> dataset from Data.gov.sg. The analysis focuses on for <strong>five-room flats</strong>.</p>
<p>Here are the predictors that we used:</p>
<p><strong>Structural factors:</strong> - Area of the unit - Floor level - Remaining lease - Age of the unit</p>
<p><strong>Locational factors:</strong> - Proximity to the Central Business District (CBD) - Proximity to eldercare facilities - Proximity to food courts/hawker centers - Proximity to MRT stations - Proximity to parks - Proximity to shopping malls - Number of preschools within 400 meters - Number of primary and secondary schools within 400 meters</p>
<p>These variables provide a foundation for modeling to help capture both the physical characteristics of the flats and the surrounding amenities that may impact resale prices.</p>
</section>
<section id="geospatial-data-wrangling" class="level1">
<h1>4. GEOSPATIAL DATA WRANGLING</h1>
<section id="installing-the-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-the-r-packages">4.1 INSTALLING THE R PACKAGES</h2>
<p>This code chunk uses <code>p_load()</code> of the <strong><em>pacman</em></strong> package (stands for Package Manager) to check if the following packages are installed in the computer. The packages will then be launched into R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, sf, httr, jsonlite, rvest, tmap, rsample, GWmodel, SpatialML, ranger, stringr, ggplot2, corrplot, car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">4.2 Loading the Data</h2>
<p>This code reads and processes a CSV file containing HDB resale transaction data. It filters the records to include only transactions between January 2023 and September 2024, focusing specifically on 5-room flats. It then creates a new <code>address</code> column by combining the block number and street name, and extracts and formats the remaining lease period into years (<code>remaining_lease_yr</code>) and months (<code>remaining_lease_mth</code>). Finally, it displays the processed data for inspection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/resale.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2023-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2024-09"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>resale_tidy <span class="ot">&lt;-</span> resale <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">address =</span> <span class="fu">paste</span>(block, street_name)) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_yr =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">0</span>, <span class="dv">2</span>)),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_mth =</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">==</span> <span class="st">"5 ROOM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resale_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,886 × 14
   month   town       flat_type block street_name    storey_range floor_area_sqm
   &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;                 &lt;dbl&gt;
 1 2023-01 ANG MO KIO 5 ROOM    306   ANG MO KIO AV… 16 TO 18                123
 2 2023-01 ANG MO KIO 5 ROOM    306   ANG MO KIO AV… 04 TO 06                123
 3 2023-01 ANG MO KIO 5 ROOM    402   ANG MO KIO AV… 10 TO 12                119
 4 2023-01 ANG MO KIO 5 ROOM    259   ANG MO KIO AV… 13 TO 15                135
 5 2023-01 ANG MO KIO 5 ROOM    176   ANG MO KIO AV… 04 TO 06                119
 6 2023-01 ANG MO KIO 5 ROOM    618   ANG MO KIO AV… 13 TO 15                133
 7 2023-01 ANG MO KIO 5 ROOM    520   ANG MO KIO AV… 19 TO 21                118
 8 2023-01 ANG MO KIO 5 ROOM    700C  ANG MO KIO AV… 19 TO 21                111
 9 2023-01 ANG MO KIO 5 ROOM    714   ANG MO KIO AV… 10 TO 12                119
10 2023-01 ANG MO KIO 5 ROOM    253   ANG MO KIO ST… 04 TO 06                128
# ℹ 10,876 more rows
# ℹ 7 more variables: flat_model &lt;chr&gt;, lease_commence_date &lt;dbl&gt;,
#   remaining_lease &lt;chr&gt;, resale_price &lt;dbl&gt;, address &lt;chr&gt;,
#   remaining_lease_yr &lt;int&gt;, remaining_lease_mth &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="getting-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="getting-coordinates">4.3 Getting Coordinates</h2>
<p>The following code chunks below retrieve and process geographical coordinates for a list of addresses. It begins by defining the <code>get_coords</code> function, which takes a list of addresses (<code>add_list</code>) and uses the <strong>OneMap API</strong> to obtain postal codes, latitudes, and longitudes for each address. The function creates a <code>postal_coords</code> data frame to store these results. For each address, if only one matching record is found, its coordinates are added. If multiple results are found, entries with “NIL” postal codes are ignored, and the first valid result is used. If no results are found, the coordinates are set to <code>NA</code>.</p>
<p>Once the coordinates are collected, they are saved as an <code>.rds</code> file. The code then reads this file, converts the data to a spatial (<code>sf</code>) object, specifying the latitude and longitude columns, and transforms it into the SVY21 (EPSG:3414) coordinate system, commonly used in Singapore. Finally, the structure of the new <code>sf</code> object is displayed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>resale_selected <span class="ot">&lt;-</span> resale_tidy <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="st">"2024-09"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>add_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_selected<span class="sc">$</span>address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>get_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(add_list){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to store all retrieved coordinates</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  postal_coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> add_list){</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(i)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">'https://www.onemap.gov.sg/api/common/elastic/search?'</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">query=</span><span class="fu">list</span>(<span class="at">searchVal=</span>i,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">returnGeom=</span><span class="st">'Y'</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">getAddrDetails=</span><span class="st">'Y'</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(r<span class="sc">$</span>content))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    found <span class="ot">&lt;-</span> data<span class="sc">$</span>found</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> data<span class="sc">$</span>results</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new data frame for each address</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If single result, append </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (found <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      postal <span class="ot">&lt;-</span> res<span class="sc">$</span>POSTAL </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> res<span class="sc">$</span>LATITUDE</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      lng <span class="ot">&lt;-</span> res<span class="sc">$</span>LONGITUDE</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> postal, </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> lat, </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> lng)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If multiple results, drop NIL and append top 1</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (found <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove those with NIL as postal</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>      res_sub <span class="ot">&lt;-</span> res[res<span class="sc">$</span>POSTAL <span class="sc">!=</span> <span class="st">"NIL"</span>, ]</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set as NA first if no Postal</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(res_sub) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>          new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                                <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                                <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        top1 <span class="ot">&lt;-</span> <span class="fu">head</span>(res_sub, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        postal <span class="ot">&lt;-</span> top1<span class="sc">$</span>POSTAL </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        lat <span class="ot">&lt;-</span> top1<span class="sc">$</span>LATITUDE</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        lng <span class="ot">&lt;-</span> top1<span class="sc">$</span>LONGITUDE</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                              <span class="at">postal =</span> postal, </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                              <span class="at">latitude =</span> lat, </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                              <span class="at">longitude =</span> lng)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the row</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    postal_coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(postal_coords, new_row)</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(postal_coords)</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(add_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line of code saves the <code>coords</code> object as an <code>.rds</code> file to store spatial data for future use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords, <span class="st">"data/geospatial/coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This file can be reloaded later using <code>readRDS</code>, which reads the data back into the environment without needing to repeat prior processing steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the spatial data (coords) from an .rds file</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/geospatial/coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-within-boundaries" class="level2">
<h2 class="anchored" data-anchor-id="filtering-within-boundaries">4.4 Filtering Within Boundaries</h2>
<p>This code performs spatial data processing and mapping with <code>sf</code> and <code>tmap</code> packages. Here’s a summary of each step:</p>
<ol type="1">
<li><p><strong>Joining Datasets</strong>: It starts by performing a left join between <code>coords_sf</code> (spatial coordinates of addresses) and <code>resale_tidy</code> (resale transaction data), using <code>address</code> as the common column. This merged data is expected to retain the <code>sf</code> geometry.</p></li>
<li><p><strong>Loading and Converting Geospatial Data</strong>: The <code>mpsz</code> dataset, containing Singapore’s subzone boundaries, is loaded and converted into an <code>sf</code> object. It’s reprojected to Singapore’s SVY21 coordinate system (EPSG:3414) for accurate spatial analysis.</p></li>
<li><p><strong>Mapping Subzones</strong>: A basic map of the <code>mpsz</code> dataset is created using <code>tmap</code>, displaying polygons representing Singapore’s subzones.</p></li>
<li><p><strong>Handling MULTIPOLYGONS</strong>: The code then:</p>
<ul>
<li>Converts <code>MULTIPOLYGON</code> geometries in <code>mpsz</code> to individual <code>POLYGON</code> geometries.</li>
<li>Calculates the area of each polygon.</li>
<li>Selects the largest polygon within each subzone, identified by <code>SUBZONE_N</code>, retaining only the largest area to simplify further analysis.</li>
</ul></li>
<li><p><strong>Filtering by Spatial Join</strong>: The <code>joined_data</code> dataset is filtered to include only points within the largest polygons of each subzone, using <code>st_within()</code> to spatially subset the points that fall inside the boundaries.</p></li>
<li><p><strong>Final Map Display</strong>: Finally, a map of the final dataset is displayed with points (using <code>tm_dots()</code>), representing the filtered HDB resale transactions overlaid on the subzones map.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert coords to an sf object, specifying latitude first, then longitude</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>coords_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(coords, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SVY21 (EPSG:3414) if needed</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>coords_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coords_sf, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of the new sf object</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(coords_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 487 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
                 address postal                  geometry
1         101 SIMEI ST 1 520101  POINT (41144.95 35890.2)
2     102 TECK WHYE LANE 680102 POINT (19216.72 39896.49)
3     102A PUNGGOL FIELD 821102 POINT (36064.38 42301.51)
4     103 CLEMENTI ST 14 120103 POINT (20861.59 33870.73)
5     106 TAMPINES ST 11 521106 POINT (40726.66 36629.85)
6    106A BIDADARI PK DR 341106 POINT (32222.45 35147.86)
7     106A PUNGGOL FIELD 821106 POINT (36349.34 42055.12)
8          107 JLN RAJAH 320107  POINT (30412.22 34452.8)
9  107A EDGEFIELD PLAINS 821107 POINT (36180.37 42120.79)
10    108A CANBERRA WALK 751108 POINT (27772.55 47711.53)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the left join on the common column, 'address'</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> coords_sf <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(resale_tidy, <span class="at">by =</span> <span class="st">"address"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the class to confirm it's still an sf object with geometry retained</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">class</span>(joined_data)) <span class="co"># Should return `sf` if geometry is intact</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mpsz <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/geospatial/mpsz.rds"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mpsz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 332 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21 / Singapore TM
First 10 features:
                 SUBZONE_N SUBZONE_C       PLN_AREA_N PLN_AREA_C       REGION_N
1              MARINA EAST    MESZ01      MARINA EAST         ME CENTRAL REGION
2         INSTITUTION HILL    RVSZ05     RIVER VALLEY         RV CENTRAL REGION
3           ROBERTSON QUAY    SRSZ01  SINGAPORE RIVER         SR CENTRAL REGION
4  JURONG ISLAND AND BUKOM    WISZ01  WESTERN ISLANDS         WI    WEST REGION
5             FORT CANNING    MUSZ02           MUSEUM         MU CENTRAL REGION
6         MARINA EAST (MP)    MPSZ05    MARINE PARADE         MP CENTRAL REGION
7                   SUDONG    WISZ03  WESTERN ISLANDS         WI    WEST REGION
8                  SEMAKAU    WISZ02  WESTERN ISLANDS         WI    WEST REGION
9           SOUTHERN GROUP    SISZ02 SOUTHERN ISLANDS         SI CENTRAL REGION
10                 SENTOSA    SISZ01 SOUTHERN ISLANDS         SI CENTRAL REGION
   REGION_C                       geometry
1        CR MULTIPOLYGON (((33222.98 29...
2        CR MULTIPOLYGON (((28481.45 30...
3        CR MULTIPOLYGON (((28087.34 30...
4        WR MULTIPOLYGON (((14557.7 304...
5        CR MULTIPOLYGON (((29542.53 31...
6        CR MULTIPOLYGON (((35279.55 30...
7        WR MULTIPOLYGON (((15772.59 21...
8        WR MULTIPOLYGON (((19843.41 21...
9        CR MULTIPOLYGON (((30870.53 22...
10       CR MULTIPOLYGON (((26879.04 26...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mpsz_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mpsz, <span class="at">mpsz =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set tmap to static mode</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a basic map with `mpsz`</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz_sf) <span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Convert MULTIPOLYGON geometries to individual POLYGON geometries</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>mpsz_polygons <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(mpsz, <span class="st">"POLYGON"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate the area for each POLYGON</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>mpsz_polygons <span class="ot">&lt;-</span> mpsz_polygons <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area =</span> <span class="fu">st_area</span>(geometry))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Group by original MULTIPOLYGON identifier and keep the largest POLYGON by area</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace `unique_id` with the column that uniquely identifies each MULTIPOLYGON</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>mpsz_largest_polygons <span class="ot">&lt;-</span> mpsz_polygons <span class="sc">%&gt;%</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SUBZONE_N) <span class="sc">%&gt;%</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="fu">max</span>(area)) <span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result to verify</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mpsz_largest_polygons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 332 features and 7 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 19021.55 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21 / Singapore TM
# A tibble: 332 × 8
   SUBZONE_N               SUBZONE_C PLN_AREA_N     PLN_AREA_C REGION_N REGION_C
   &lt;chr&gt;                   &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   
 1 MARINA EAST             MESZ01    MARINA EAST    ME         CENTRAL… CR      
 2 INSTITUTION HILL        RVSZ05    RIVER VALLEY   RV         CENTRAL… CR      
 3 ROBERTSON QUAY          SRSZ01    SINGAPORE RIV… SR         CENTRAL… CR      
 4 JURONG ISLAND AND BUKOM WISZ01    WESTERN ISLAN… WI         WEST RE… WR      
 5 FORT CANNING            MUSZ02    MUSEUM         MU         CENTRAL… CR      
 6 MARINA EAST (MP)        MPSZ05    MARINE PARADE  MP         CENTRAL… CR      
 7 SUDONG                  WISZ03    WESTERN ISLAN… WI         WEST RE… WR      
 8 SEMAKAU                 WISZ02    WESTERN ISLAN… WI         WEST RE… WR      
 9 SOUTHERN GROUP          SISZ02    SOUTHERN ISLA… SI         CENTRAL… CR      
10 SENTOSA                 SISZ01    SOUTHERN ISLA… SI         CENTRAL… CR      
# ℹ 322 more rows
# ℹ 2 more variables: geometry &lt;POLYGON [m]&gt;, area [m^2]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set tmap to static mode</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a basic map with `mpsz`</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz_largest_polygons) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>First, both <code>joined_data</code> (the points data) and <code>mpsz_largest_polygons</code> (the largest subzone polygons) are transformed to the SVY21 coordinate system (EPSG:3414) for accurate spatial alignment. A spatial join is performed using <code>st_join</code> with the <code>st_within</code> join type. This operation links each point in <code>joined_data</code> to its containing polygon in <code>mpsz_largest_polygons</code>, effectively adding polygon attributes to each point to filter the dataset. This allows us to retain only the points that fall within specific polygons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(joined_data, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>mpsz_largest_polygons <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mpsz_largest_polygons, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">st_join</span>(joined_data, mpsz_largest_polygons, <span class="at">join =</span> st_within)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 22 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry
1  2777496.6 [m^2]  POINT (41144.95 35890.2)
2  2777496.6 [m^2]  POINT (41144.95 35890.2)
3  1003202.6 [m^2] POINT (19216.72 39896.49)
4  1003202.6 [m^2] POINT (19216.72 39896.49)
5  1378710.5 [m^2] POINT (36064.38 42301.51)
6  1378710.5 [m^2] POINT (36064.38 42301.51)
7   963924.6 [m^2] POINT (20861.59 33870.73)
8   963924.6 [m^2] POINT (20861.59 33870.73)
9   963924.6 [m^2] POINT (20861.59 33870.73)
10  963924.6 [m^2] POINT (20861.59 33870.73)</code></pre>
</div>
</div>
<p>The code chunk below creates a map displaying <code>mpsz_largest_polygons</code> as light blue polygons with dark blue borders and overlays <code>joined_data</code> as red points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set tmap to plot mode for a static map</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both polygons and points</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz_largest_polygons) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">border.col =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(joined_data) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Points within Boundaries"</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-derived-variables---from-other-sources" class="level2">
<h2 class="anchored" data-anchor-id="adding-derived-variables---from-other-sources">4.5 ADDING DERIVED VARIABLES - from other sources</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">1. ELDERCARE FACILITIES</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">2. CBD - SPECIFICALLY RAFFLES PLACE</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">3. HAWKER CENTRES</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">4. SHOPPING MALLS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">5. TRAIN STATIONS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">6. PARKS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">7. NUMBER OF SCHOOLS (PRE, PRIMARY, SECONDARY) WITHIN 400M</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Eldercare facility data is loaded from Data.gov.sg, and is transformed to match the coordinate system of the HDB resale dataset, and then calculated the distance from each HDB resale location to the nearest eldercare facility. This distance was added as a new variable in the dataset to analyze accessibility to eldercare services for each resale location.</p>
<p><strong>We do this to all the outsourced data that we have gotten.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/EldercareServicesSHP"</span>, <span class="at">layer =</span> <span class="st">"ELDERCARE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ELDERCARE' from data source 
  `C:\loriellemalveda\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\EldercareServicesSHP' 
  using driver `ESRI Shapefile'
Simple feature collection with 133 features and 18 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 14481.92 ymin: 28218.43 xmax: 41665.14 ymax: 46804.9
Projected CRS: SVY21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eldercare, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>eldercare <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eldercare, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Find the nearest eldercare point for each HDB point</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>nearest_eldercare_index <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(joined_data, eldercare)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate the distance to the nearest eldercare point</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_eldercare =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, eldercare[nearest_eldercare_index, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the updated dataset</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 23 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>This code calculates the distance from each HDB location to Raffles Place, which represents Singapore’s Central Business District (CBD). First, the coordinates for Raffles Place (103.8514, 1.2839 in WGS84) are defined and then transformed to match the CRS of the HDB dataset (EPSG:3414). Using <code>st_distance</code>, the distance from each HDB point to the CBD is computed and added to <code>joined_data</code> as a new column, <code>distance_to_cbd</code>, to assess proximity to the CBD for each resale property.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the CBD point (Raffles Place coordinates in WGS84)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>cbd_point <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">103.8514</span>, <span class="fl">1.2839</span>)), <span class="at">crs =</span> <span class="dv">4326</span>)  <span class="co"># WGS84</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform CBD point to the same CRS as joined_data (EPSG:3414)</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>cbd_point <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(cbd_point, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the distance from each HDB point to the CBD point</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_cbd =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, cbd_point)[, <span class="dv">1</span>]))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset with distance to CBD</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 24 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
   distance_to_cbd
1         12790.41
2         12790.41
3         14923.59
4         14923.59
5         14076.30
6         14076.30
7         10101.36
8         10101.36
9         10101.36
10        10101.36</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>This code calculates the distance from each HDB resale location to the nearest hawker center. It first ensures that both <code>joined_data</code> (HDB resale data) and <code>hawker</code> (hawker center locations) are in the same coordinate reference system (EPSG:3414). Then, using <code>st_nearest_feature</code>, it identifies the index of the closest hawker center for each HDB location. The <code>st_distance</code> function calculates the distance from each HDB point to its nearest hawker center, adding this as a new column, <code>distance_to_hawker</code>, in the <code>joined_data</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>hawker <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/HawkerCentresKML.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `HAWKERCENTRE' from data source 
  `C:\loriellemalveda\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\HawkerCentresKML.kml' 
  using driver `KML'
Simple feature collection with 125 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6974 ymin: 1.272716 xmax: 103.9882 ymax: 1.449017
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both datasets are in the same CRS</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>hawker <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(hawker, <span class="at">crs =</span> <span class="dv">3414</span>)  <span class="co"># Assuming hawker dataset is in sf format</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Find the index of the nearest hawker center for each HDB point</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>nearest_hawker_index <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(joined_data, hawker)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate the distance to the nearest hawker center</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_hawker =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, hawker[nearest_hawker_index, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset with the new distance column</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 25 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
   distance_to_cbd distance_to_hawker
1         12790.41           924.5228
2         12790.41           924.5228
3         14923.59          1333.7754
4         14923.59          1333.7754
5         14076.30          1040.3345
6         14076.30          1040.3345
7         10101.36           927.6112
8         10101.36           927.6112
9         10101.36           927.6112
10        10101.36           927.6112</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>The following code chunks loads shopping mall location data from a CSV file (sourced from Kaggle), converts it into a spatial <code>sf</code> object using the latitude and longitude columns, and sets the coordinate reference system to WGS84 (EPSG:4326). Following the same approach as with the eldercare and hawker center data, it ensures both the HDB dataset and shopping mall locations are in the same coordinate system. Using spatial functions, it then calculates the distance from each HDB resale location to the nearest shopping mall, and adds this as a new column to the HDB dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Read the CSV file (replace 'malls.csv' with the path to your file)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>malls_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/aspatial/shopping_mall_coordinates.csv"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Convert to sf object using latitude and longitude columns</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the latitude and longitude columns are named "lat" and "long"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>malls_sf <span class="ot">&lt;-</span> malls_data <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>, <span class="st">"LATITUDE"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)  <span class="co"># WGS84 CRS</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># View the resulting sf object to confirm it has geometry</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(malls_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 155 features and 1 field
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 103.6972 ymin: 1.274588 xmax: 103.99 ymax: 1.448231
Geodetic CRS:  WGS 84
First 10 features:
                        Mall.Name                  geometry
1                          100 AM POINT (103.8435 1.274588)
2                    313@Somerset POINT (103.8384 1.301014)
3                          Aperia POINT (103.8643 1.310474)
4  Balestier Hill Shopping Centre POINT (103.8426 1.325596)
5                      Bugis Cube POINT (103.8556 1.298141)
6                  Bugis Junction POINT (103.8554 1.299113)
7                          Bugis+ POINT (103.8552 1.300952)
8                  Capitol Piazza POINT (103.8513 1.293079)
9      Cathay Cineleisure Orchard POINT (103.8365 1.301464)
10                The Centrepoint    POINT (103.84 1.30145)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>malls_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(malls_sf, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>malls_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(malls_sf, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Find the index of the nearest mall for each HDB point</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>nearest_mall_index <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(joined_data, malls_sf)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate the distance to the nearest mall</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_mall =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, malls_sf[nearest_mall_index, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset with the new distance column</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 26 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
   distance_to_cbd distance_to_hawker distance_to_mall
1         12790.41           924.5228         271.0456
2         12790.41           924.5228         271.0456
3         14923.59          1333.7754         390.7374
4         14923.59          1333.7754         390.7374
5         14076.30          1040.3345         748.0958
6         14076.30          1040.3345         748.0958
7         10101.36           927.6112        1001.6526
8         10101.36           927.6112        1001.6526
9         10101.36           927.6112        1001.6526
10        10101.36           927.6112        1001.6526</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p>This code processes train station data from a KML file from <em>data.gov.sg</em>, converts it to a spatial format and sets the coordinate reference system to EPSG:3414 (SVY21) for Singapore. It begins by checking for and identifying any invalid geometries in <code>train_stations</code>. After confirming both <code>train_stations</code> and <code>joined_data</code> (HDB resale data) are in the same CRS, the code calculates the distance from each HDB resale location to the nearest train station using spatial functions.</p>
<p>This distance is added as a new column, <code>distance_to_mrt</code>, in the <code>joined_data</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/LTAMRTStationExitKML.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MRT_EXITS' from data source 
  `C:\loriellemalveda\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\LTAMRTStationExitKML.kml' 
  using driver `KML'
Simple feature collection with 563 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6368 ymin: 1.264972 xmax: 103.9893 ymax: 1.449157
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(train_stations, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure train_stations is in the desired CRS (e.g., EPSG:3414)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>train_stations <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(train_stations, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Identify invalid polygons</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>invalid_polygons <span class="ot">&lt;-</span> train_stations <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">st_is_valid</span>(geometry))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: View invalid polygons</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(invalid_polygons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 2 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Projected CRS: SVY21 / Singapore TM
[1] Name        Description geometry   
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>train_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(train_stations, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Find the index of the nearest mall for each HDB point</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>nearest_mrt_index <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(joined_data, train_sf)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate the distance to the nearest mall</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_mrt =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, train_sf[nearest_mrt_index, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset with the new distance column</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 27 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
   distance_to_cbd distance_to_hawker distance_to_mall distance_to_mrt
1         12790.41           924.5228         271.0456       332.54769
2         12790.41           924.5228         271.0456       332.54769
3         14923.59          1333.7754         390.7374        85.37721
4         14923.59          1333.7754         390.7374        85.37721
5         14076.30          1040.3345         748.0958        36.02671
6         14076.30          1040.3345         748.0958        36.02671
7         10101.36           927.6112        1001.6526       903.86491
8         10101.36           927.6112        1001.6526       903.86491
9         10101.36           927.6112        1001.6526       903.86491
10        10101.36           927.6112        1001.6526       903.86491</code></pre>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p>This code loads park data from a KML file from <em>data.gov.sg</em>, converts it to an <code>sf</code> spatial format, and sets the coordinate reference system to EPSG:3414 (SVY21) for consistency with the HDB resale data. After ensuring that both <code>joined_data</code> (HDB data) and <code>parks</code> are in the same CRS, it calculates the distance from each HDB resale location to the nearest park. This distance is added as a new column, <code>distance_to_parks</code>, in the <code>joined_data</code> dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>parks <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/Parks.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `NATIONALPARKS' from data source 
  `C:\loriellemalveda\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\Parks.kml' 
  using driver `KML'
Simple feature collection with 430 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6929 ymin: 1.214491 xmax: 104.0538 ymax: 1.462094
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>parks<span class="ot">&lt;-</span> <span class="fu">st_transform</span>(parks, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>parks_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(parks, <span class="at">crs =</span> <span class="dv">3414</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Find the index of the nearest mall for each HDB point</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>nearest_parks_index <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(joined_data, parks_sf)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate the distance to the nearest mall</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_parks =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, parks_sf[nearest_parks_index, ], <span class="at">by_element =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset with the new distance column</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 28 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
   distance_to_cbd distance_to_hawker distance_to_mall distance_to_mrt
1         12790.41           924.5228         271.0456       332.54769
2         12790.41           924.5228         271.0456       332.54769
3         14923.59          1333.7754         390.7374        85.37721
4         14923.59          1333.7754         390.7374        85.37721
5         14076.30          1040.3345         748.0958        36.02671
6         14076.30          1040.3345         748.0958        36.02671
7         10101.36           927.6112        1001.6526       903.86491
8         10101.36           927.6112        1001.6526       903.86491
9         10101.36           927.6112        1001.6526       903.86491
10        10101.36           927.6112        1001.6526       903.86491
   distance_to_parks
1           256.4781
2           256.4781
3           341.9659
4           341.9659
5           828.0045
6           828.0045
7           459.1670
8           459.1670
9           459.1670
10          459.1670</code></pre>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<p>This code calculates the number of preschools and schools within a 400-meter radius of each HDB resale location. This distance is chosen as it is reasonable for walking or easy travel. It first loads and transforms the preschool and school zone data into the same coordinate reference system (EPSG:3414) as the HDB data in <code>joined_data</code>. Then, it creates a 400-meter buffer around each HDB point to represent a walkable area. Using <code>st_intersects</code>, it identifies which preschools and schools fall within each buffer and counts them. These counts are added to <code>joined_data</code> as new columns, <code>preschools_within_400m</code> and <code>schools_within_400m</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>preschools <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial/PreSchoolsLocation.kml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `PRESCHOOLS_LOCATION' from data source 
  `C:\loriellemalveda\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\PreSchoolsLocation.kml' 
  using driver `KML'
Simple feature collection with 2290 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>school_zones <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial/SchoolZone_Jan2024/SchoolZone_Jan2024"</span>, <span class="at">layer=</span><span class="st">"SCHOOLZONE"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SCHOOLZONE' from data source 
  `C:\loriellemalveda\ISSS626-GAA\Take-home_Ex\Take-home_Ex03\data\geospatial\SchoolZone_Jan2024\SchoolZone_Jan2024' 
  using driver `ESRI Shapefile'
Simple feature collection with 211 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 11717.22 ymin: 28358.21 xmax: 42850.04 ymax: 48798.1
Projected CRS: SVY21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>school_zones <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(school_zones, <span class="at">crs =</span> <span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>preschools <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(preschools, <span class="at">crs =</span> <span class="dv">3414</span>)    <span class="co"># Assuming preschools is an sf object</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>schools <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(school_zones, <span class="at">crs =</span> <span class="dv">3414</span>)          <span class="co"># Assuming schools is an sf object</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 500m buffer around each HDB point</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>hdb_buffers <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(joined_data, <span class="at">dist =</span> <span class="dv">400</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Count preschools within each HDB buffer</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use st_intersects to identify preschools within each buffer</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>preschools_within_buffer <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(hdb_buffers, preschools)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>joined_data<span class="sc">$</span>preschools_within_400m <span class="ot">&lt;-</span> <span class="fu">sapply</span>(preschools_within_buffer, length)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Count schools within each HDB buffer</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>schools_within_buffer <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(hdb_buffers, schools)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>joined_data<span class="sc">$</span>schools_within_400m <span class="ot">&lt;-</span> <span class="fu">sapply</span>(schools_within_buffer, length)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset to check counts</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2052 features and 30 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11755.72 ymin: 28457.97 xmax: 42441.24 ymax: 48339.17
Projected CRS: SVY21 / Singapore TM
First 10 features:
              address postal   month          town flat_type block
1      101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2      101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3  102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4  102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5  102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6  102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
7  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
8  103 CLEMENTI ST 14 120103 2023-04      CLEMENTI    5 ROOM   103
9  103 CLEMENTI ST 14 120103 2023-07      CLEMENTI    5 ROOM   103
10 103 CLEMENTI ST 14 120103 2024-07      CLEMENTI    5 ROOM   103
      street_name storey_range floor_area_sqm flat_model lease_commence_date
1      SIMEI ST 1     01 TO 03            128   Improved                1988
2      SIMEI ST 1     01 TO 03            122   Improved                1988
3  TECK WHYE LANE     01 TO 03            121   Improved                1989
4  TECK WHYE LANE     01 TO 03            121   Improved                1989
5   PUNGGOL FIELD     01 TO 03            110   Improved                2002
6   PUNGGOL FIELD     16 TO 18            110   Improved                2002
7  CLEMENTI ST 14     10 TO 12            121   Improved                1984
8  CLEMENTI ST 14     07 TO 09            123   Improved                1984
9  CLEMENTI ST 14     04 TO 06            121   Improved                1984
10 CLEMENTI ST 14     13 TO 15            123   Improved                1984
      remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1  64 years 03 months       680000                 64                   3
2   63 years 01 month       715000                 63                   1
3  64 years 11 months       520000                 64                  11
4  63 years 08 months       575000                 63                   8
5  77 years 04 months       603888                 77                   4
6  77 years 03 months       655000                 77                   3
7  60 years 08 months       808800                 60                   8
8  60 years 08 months       800000                 60                   8
9  60 years 05 months       758000                 60                   5
10 59 years 06 months       500000                 59                   6
       SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2          SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4      TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6  PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
7     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
8     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
9     SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
10    SUNSET WAY    CLSZ02      CLEMENTI         CL       WEST REGION       WR
              area                  geometry distance_to_eldercare
1  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
2  2777496.6 [m^2]  POINT (41144.95 35890.2)              758.1380
3  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
4  1003202.6 [m^2] POINT (19216.72 39896.49)              327.6085
5  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
6  1378710.5 [m^2] POINT (36064.38 42301.51)              701.7365
7   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
8   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
9   963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
10  963924.6 [m^2] POINT (20861.59 33870.73)              378.3587
   distance_to_cbd distance_to_hawker distance_to_mall distance_to_mrt
1         12790.41           924.5228         271.0456       332.54769
2         12790.41           924.5228         271.0456       332.54769
3         14923.59          1333.7754         390.7374        85.37721
4         14923.59          1333.7754         390.7374        85.37721
5         14076.30          1040.3345         748.0958        36.02671
6         14076.30          1040.3345         748.0958        36.02671
7         10101.36           927.6112        1001.6526       903.86491
8         10101.36           927.6112        1001.6526       903.86491
9         10101.36           927.6112        1001.6526       903.86491
10        10101.36           927.6112        1001.6526       903.86491
   distance_to_parks preschools_within_400m schools_within_400m
1           256.4781                      5                   1
2           256.4781                      5                   1
3           341.9659                      7                   0
4           341.9659                      7                   0
5           828.0045                     10                   1
6           828.0045                     10                   1
7           459.1670                      3                   0
8           459.1670                      3                   0
9           459.1670                      3                   0
10          459.1670                      3                   0</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This code converts the distance variables in <code>joined_data</code> from meters to kilometers for easier interpretation. It divides each distance column—<code>distance_to_eldercare</code>, <code>distance_to_cbd</code>, <code>distance_to_hawker</code>, <code>distance_to_mall</code>, <code>distance_to_mrt</code>, and <code>distance_to_parks</code>—by 1,000, to represent distances in kilometers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert distance variables from meters to kilometers</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_to_eldercare =</span> distance_to_eldercare <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_to_cbd =</span> distance_to_cbd <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_to_hawker =</span> distance_to_hawker <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_to_mall =</span> distance_to_mall <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_to_mrt =</span> distance_to_mrt <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_to_parks =</span> distance_to_parks <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="derived-variables-from-the-original-dataset" class="level2">
<h2 class="anchored" data-anchor-id="derived-variables-from-the-original-dataset">4.6 Derived Variables From the Original Dataset</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">1. TOTAL REMAINING LEASE</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">2. YEARS SINCE LEASE COMMENCEMENT</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">3. MEDIAN STOREY</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>A new variable, <code>total_remaining_lease_mths</code>, calculates the total remaining lease time by converting years and months into a single metric in months.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_remaining_lease_mths =</span> (remaining_lease_yr <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">+</span> remaining_lease_mth)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset to confirm the new column</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 31 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 19216.72 ymin: 35890.2 xmax: 41144.95 ymax: 42301.51
Projected CRS: SVY21 / Singapore TM
             address postal   month          town flat_type block
1     101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2     101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3 102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4 102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5 102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6 102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
     street_name storey_range floor_area_sqm flat_model lease_commence_date
1     SIMEI ST 1     01 TO 03            128   Improved                1988
2     SIMEI ST 1     01 TO 03            122   Improved                1988
3 TECK WHYE LANE     01 TO 03            121   Improved                1989
4 TECK WHYE LANE     01 TO 03            121   Improved                1989
5  PUNGGOL FIELD     01 TO 03            110   Improved                2002
6  PUNGGOL FIELD     16 TO 18            110   Improved                2002
     remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1 64 years 03 months       680000                 64                   3
2  63 years 01 month       715000                 63                   1
3 64 years 11 months       520000                 64                  11
4 63 years 08 months       575000                 63                   8
5 77 years 04 months       603888                 77                   4
6 77 years 03 months       655000                 77                   3
      SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1         SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2         SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3     TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4     TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5 PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6 PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
           area                  geometry distance_to_eldercare distance_to_cbd
1 2777497 [m^2]  POINT (41144.95 35890.2)             0.7581380        12.79041
2 2777497 [m^2]  POINT (41144.95 35890.2)             0.7581380        12.79041
3 1003203 [m^2] POINT (19216.72 39896.49)             0.3276085        14.92359
4 1003203 [m^2] POINT (19216.72 39896.49)             0.3276085        14.92359
5 1378711 [m^2] POINT (36064.38 42301.51)             0.7017365        14.07630
6 1378711 [m^2] POINT (36064.38 42301.51)             0.7017365        14.07630
  distance_to_hawker distance_to_mall distance_to_mrt distance_to_parks
1          0.9245228        0.2710456      0.33254769         0.2564781
2          0.9245228        0.2710456      0.33254769         0.2564781
3          1.3337754        0.3907374      0.08537721         0.3419659
4          1.3337754        0.3907374      0.08537721         0.3419659
5          1.0403345        0.7480958      0.03602671         0.8280045
6          1.0403345        0.7480958      0.03602671         0.8280045
  preschools_within_400m schools_within_400m total_remaining_lease_mths
1                      5                   1                        771
2                      5                   1                        757
3                      7                   0                        779
4                      7                   0                        764
5                     10                   1                        928
6                     10                   1                        927</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>This basically calculates the age of the unit. The <code>years_since_lease_commence</code> variable calculates the age of the lease from its commencement up to the year 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new column calculating the age of the lease based on 2024</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">years_since_lease_commence =</span> <span class="dv">2024</span> <span class="sc">-</span> lease_commence_date)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 32 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 19216.72 ymin: 35890.2 xmax: 41144.95 ymax: 42301.51
Projected CRS: SVY21 / Singapore TM
             address postal   month          town flat_type block
1     101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2     101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3 102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4 102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5 102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6 102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
     street_name storey_range floor_area_sqm flat_model lease_commence_date
1     SIMEI ST 1     01 TO 03            128   Improved                1988
2     SIMEI ST 1     01 TO 03            122   Improved                1988
3 TECK WHYE LANE     01 TO 03            121   Improved                1989
4 TECK WHYE LANE     01 TO 03            121   Improved                1989
5  PUNGGOL FIELD     01 TO 03            110   Improved                2002
6  PUNGGOL FIELD     16 TO 18            110   Improved                2002
     remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1 64 years 03 months       680000                 64                   3
2  63 years 01 month       715000                 63                   1
3 64 years 11 months       520000                 64                  11
4 63 years 08 months       575000                 63                   8
5 77 years 04 months       603888                 77                   4
6 77 years 03 months       655000                 77                   3
      SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1         SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2         SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3     TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4     TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5 PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6 PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
           area                  geometry distance_to_eldercare distance_to_cbd
1 2777497 [m^2]  POINT (41144.95 35890.2)             0.7581380        12.79041
2 2777497 [m^2]  POINT (41144.95 35890.2)             0.7581380        12.79041
3 1003203 [m^2] POINT (19216.72 39896.49)             0.3276085        14.92359
4 1003203 [m^2] POINT (19216.72 39896.49)             0.3276085        14.92359
5 1378711 [m^2] POINT (36064.38 42301.51)             0.7017365        14.07630
6 1378711 [m^2] POINT (36064.38 42301.51)             0.7017365        14.07630
  distance_to_hawker distance_to_mall distance_to_mrt distance_to_parks
1          0.9245228        0.2710456      0.33254769         0.2564781
2          0.9245228        0.2710456      0.33254769         0.2564781
3          1.3337754        0.3907374      0.08537721         0.3419659
4          1.3337754        0.3907374      0.08537721         0.3419659
5          1.0403345        0.7480958      0.03602671         0.8280045
6          1.0403345        0.7480958      0.03602671         0.8280045
  preschools_within_400m schools_within_400m total_remaining_lease_mths
1                      5                   1                        771
2                      5                   1                        757
3                      7                   0                        779
4                      7                   0                        764
5                     10                   1                        928
6                     10                   1                        927
  years_since_lease_commence
1                         36
2                         36
3                         35
4                         35
5                         22
6                         22</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>For properties with a storey range, the <code>median_storey</code> variable estimates the average storey level by taking the midpoint between the minimum and maximum storeys in the range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the lower and upper limits of the storey range</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">storey_min =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(storey_range, <span class="st">"^</span><span class="sc">\\</span><span class="st">d+"</span>)),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">storey_max =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(storey_range, <span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the median storey as the average of min and max</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_storey =</span> (storey_min <span class="sc">+</span> storey_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated dataset</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(joined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 35 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 19216.72 ymin: 35890.2 xmax: 41144.95 ymax: 42301.51
Projected CRS: SVY21 / Singapore TM
             address postal   month          town flat_type block
1     101 SIMEI ST 1 520101 2023-07      TAMPINES    5 ROOM   101
2     101 SIMEI ST 1 520101 2024-09      TAMPINES    5 ROOM   101
3 102 TECK WHYE LANE 680102 2023-06 CHOA CHU KANG    5 ROOM   102
4 102 TECK WHYE LANE 680102 2024-09 CHOA CHU KANG    5 ROOM   102
5 102A PUNGGOL FIELD 821102 2024-08       PUNGGOL    5 ROOM  102A
6 102A PUNGGOL FIELD 821102 2024-09       PUNGGOL    5 ROOM  102A
     street_name storey_range floor_area_sqm flat_model lease_commence_date
1     SIMEI ST 1     01 TO 03            128   Improved                1988
2     SIMEI ST 1     01 TO 03            122   Improved                1988
3 TECK WHYE LANE     01 TO 03            121   Improved                1989
4 TECK WHYE LANE     01 TO 03            121   Improved                1989
5  PUNGGOL FIELD     01 TO 03            110   Improved                2002
6  PUNGGOL FIELD     16 TO 18            110   Improved                2002
     remaining_lease resale_price remaining_lease_yr remaining_lease_mth
1 64 years 03 months       680000                 64                   3
2  63 years 01 month       715000                 63                   1
3 64 years 11 months       520000                 64                  11
4 63 years 08 months       575000                 63                   8
5 77 years 04 months       603888                 77                   4
6 77 years 03 months       655000                 77                   3
      SUBZONE_N SUBZONE_C    PLN_AREA_N PLN_AREA_C          REGION_N REGION_C
1         SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
2         SIMEI    TMSZ04      TAMPINES         TM       EAST REGION       ER
3     TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
4     TECK WHYE    CKSZ01 CHOA CHU KANG         CK       WEST REGION       WR
5 PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
6 PUNGGOL FIELD    PGSZ04       PUNGGOL         PG NORTH-EAST REGION      NER
           area                  geometry distance_to_eldercare distance_to_cbd
1 2777497 [m^2]  POINT (41144.95 35890.2)             0.7581380        12.79041
2 2777497 [m^2]  POINT (41144.95 35890.2)             0.7581380        12.79041
3 1003203 [m^2] POINT (19216.72 39896.49)             0.3276085        14.92359
4 1003203 [m^2] POINT (19216.72 39896.49)             0.3276085        14.92359
5 1378711 [m^2] POINT (36064.38 42301.51)             0.7017365        14.07630
6 1378711 [m^2] POINT (36064.38 42301.51)             0.7017365        14.07630
  distance_to_hawker distance_to_mall distance_to_mrt distance_to_parks
1          0.9245228        0.2710456      0.33254769         0.2564781
2          0.9245228        0.2710456      0.33254769         0.2564781
3          1.3337754        0.3907374      0.08537721         0.3419659
4          1.3337754        0.3907374      0.08537721         0.3419659
5          1.0403345        0.7480958      0.03602671         0.8280045
6          1.0403345        0.7480958      0.03602671         0.8280045
  preschools_within_400m schools_within_400m total_remaining_lease_mths
1                      5                   1                        771
2                      5                   1                        757
3                      7                   0                        779
4                      7                   0                        764
5                     10                   1                        928
6                     10                   1                        927
  years_since_lease_commence storey_min storey_max median_storey
1                         36          1          3             2
2                         36          1          3             2
3                         35          1          3             2
4                         35          1          3             2
5                         22          1          3             2
6                         22         16         18            17</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="plotting-the-variables" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-variables">4.7 PLOTTING THE VARIABLES</h2>
<p>These plots display the distribution of various factors related to HDB resale locations. Density plots provide a smooth view of continuous variables (such as distances to amenities), while histograms show the frequency of discrete counts (like the number of nearby preschools or schools), helping to visualize how these factors vary across the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest eldercare</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> distance_to_eldercare)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Eldercare"</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Eldercare (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest CBD</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> distance_to_cbd)) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest CBD"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to CBD (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest hawker center</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> distance_to_hawker)) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Hawker"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Hawker (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest mall</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> distance_to_mall)) <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Mall"</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Mall (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest MRT station</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> distance_to_mrt)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest MRT Station"</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to MRT Station (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest park</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> distance_to_parks)) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Park"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Park (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of preschools within 500m</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> preschools_within_400m)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"purple"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Preschools within 500m"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Preschools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of schools within 500m</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> schools_within_400m)) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Schools within 500m"</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> median_storey)) <span class="sc">+</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Median Storey"</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> total_remaining_lease_mths)) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Total Remaining Lease Months"</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> years_since_lease_commence)) <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">1</span>,<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Years since lease commence"</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> floor_area_sqm)) <span class="sc">+</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of floor area sqm"</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>( <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of resale price"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-40-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="log-transformation" class="level2">
<h2 class="anchored" data-anchor-id="log-transformation">4.8 LOG TRANSFORMATION</h2>
<p>Since several variables did not appear to follow a normal distribution, a log transformation was applied to make them more suitable for analysis in the GWR model. Adding 1 to each variable prevents issues with zero values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-transform all distance and count variables, adding +1 to avoid log(0) issues</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_distance_to_eldercare =</span> <span class="fu">log</span>(distance_to_eldercare <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_distance_to_cbd =</span> <span class="fu">log</span>(distance_to_cbd <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_distance_to_hawker =</span> <span class="fu">log</span>(distance_to_hawker <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_distance_to_mall =</span> <span class="fu">log</span>(distance_to_mall <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_distance_to_mrt =</span> <span class="fu">log</span>(distance_to_mrt <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_distance_to_parks =</span> <span class="fu">log</span>(distance_to_parks <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_preschools_within_400m =</span> <span class="fu">log</span>(preschools_within_400m <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_schools_within_400m =</span> <span class="fu">log</span>(schools_within_400m <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_median_storey =</span> <span class="fu">log</span>(median_storey <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_total_remaining_lease =</span> <span class="fu">log</span>(total_remaining_lease_mths <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_years_since_lease_commence =</span> <span class="fu">log</span>(years_since_lease_commence <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_floor_area_sqm =</span> <span class="fu">log</span>(floor_area_sqm <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_resale_price =</span> <span class="fu">log</span>(resale_price <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We plotted the log-transformed variables, which improved the visualization by normalizing skewed distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plots for log-transformed distance variables</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest eldercare</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_distance_to_eldercare)) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Eldercare"</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Eldercare (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest CBD</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_distance_to_cbd)) <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest CBD"</span>,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to CBD (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest hawker center</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_distance_to_hawker)) <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Hawker"</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Hawker (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest mall</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_distance_to_mall)) <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Mall"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Mall (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest MRT station</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_distance_to_mrt)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest MRT Station"</span>,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to MRT Station (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distance to nearest park</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_distance_to_parks)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"coral"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density of Distance to Nearest Park"</span>,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Distance to Park (meters)"</span>, <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of preschools within 500m</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_preschools_within_400m)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"purple"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Preschools within 500m"</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Preschools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of schools within 500m</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_schools_within_400m)) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Schools within 500m"</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_median_storey)) <span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Median Storey"</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_total_remaining_lease)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">1</span>,<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Total Remaining Lease Months"</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_years_since_lease_commence)) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">1</span>,<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Years since lease commence"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_floor_area_sqm)) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of floor area sqm"</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(joined_data, <span class="fu">aes</span>(<span class="at">x =</span> log_resale_price)) <span class="sc">+</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>( <span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of resale price"</span>,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Schools within 500m"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-42-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-matrix" class="level2">
<h2 class="anchored" data-anchor-id="correlation-matrix">4.7 CORRELATION MATRIX</h2>
<p>This code calculates and visualizes the correlation matrix for log-transformed variables in the <code>joined_data</code> dataset, excluding the spatial geometry.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the correlation matrix, the variables <code>log_total_remaining_lease</code> and <code>log_floor_area_sqm</code> show a strong negative correlation. This suggests that as the total remaining lease (log-transformed) decreases, the floor area (log-transformed) tends to increase, or vice versa. Therefore, we will remove <code>log_total_remaining_lease</code> from the model to reduce multicollinearity because time is also represented in other variables, as opposed to <code>log_floor_area_sqm</code>.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Drop the geometry column</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>numeric_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span>  <span class="co"># Remove the geometry column</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    log_distance_to_eldercare, log_distance_to_cbd, log_distance_to_hawker, </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    log_distance_to_mall, log_distance_to_mrt, log_distance_to_parks, </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    log_preschools_within_400m, log_schools_within_400m,</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    log_median_storey,log_total_remaining_lease, resale_price, log_years_since_lease_commence,log_floor_area_sqm</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Compute the correlation matrix</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_data, <span class="at">use =</span> <span class="st">"complete.obs"</span>)  <span class="co"># Use "complete.obs" to handle missing data</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the correlation matrix</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cor_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               log_distance_to_eldercare log_distance_to_cbd
log_distance_to_eldercare                    1.000000000          0.30118662
log_distance_to_cbd                          0.301186622          1.00000000
log_distance_to_hawker                       0.111039508          0.34659052
log_distance_to_mall                         0.009091574         -0.17058707
log_distance_to_mrt                          0.078492235          0.03578689
log_distance_to_parks                       -0.017131482          0.37375049
log_preschools_within_400m                   0.023055243          0.11970527
log_schools_within_400m                      0.013676719          0.09870777
log_median_storey                           -0.094844163         -0.19613562
log_total_remaining_lease                    0.079828286          0.24744941
resale_price                                -0.235732333         -0.64274729
log_years_since_lease_commence              -0.029641406         -0.18218299
log_floor_area_sqm                          -0.061250887         -0.08959270
                               log_distance_to_hawker log_distance_to_mall
log_distance_to_eldercare                  0.11103951         0.0090915740
log_distance_to_cbd                        0.34659052        -0.1705870741
log_distance_to_hawker                     1.00000000        -0.1627287931
log_distance_to_mall                      -0.16272879         1.0000000000
log_distance_to_mrt                       -0.04772654         0.3227345062
log_distance_to_parks                      0.11737431        -0.0004525176
log_preschools_within_400m                 0.08556389        -0.2903878034
log_schools_within_400m                    0.01876348        -0.0989959691
log_median_storey                         -0.12826378        -0.0240286633
log_total_remaining_lease                  0.09655721        -0.1667559150
resale_price                              -0.31634902         0.0343916380
log_years_since_lease_commence            -0.04537941         0.1022365068
log_floor_area_sqm                         0.00454388         0.1757466027
                               log_distance_to_mrt log_distance_to_parks
log_distance_to_eldercare              0.078492235         -0.0171314819
log_distance_to_cbd                    0.035786885          0.3737504940
log_distance_to_hawker                -0.047726540          0.1173743134
log_distance_to_mall                   0.322734506         -0.0004525176
log_distance_to_mrt                    1.000000000          0.1100091533
log_distance_to_parks                  0.110009153          1.0000000000
log_preschools_within_400m            -0.214465568          0.0313474403
log_schools_within_400m               -0.217188092          0.0420952613
log_median_storey                     -0.057106989         -0.0733363997
log_total_remaining_lease             -0.005694969          0.1992314719
resale_price                          -0.069614079         -0.2118702786
log_years_since_lease_commence        -0.076149471         -0.1950705844
log_floor_area_sqm                     0.179682293         -0.0341265725
                               log_preschools_within_400m
log_distance_to_eldercare                     0.023055243
log_distance_to_cbd                           0.119705265
log_distance_to_hawker                        0.085563887
log_distance_to_mall                         -0.290387803
log_distance_to_mrt                          -0.214465568
log_distance_to_parks                         0.031347440
log_preschools_within_400m                    1.000000000
log_schools_within_400m                       0.279534178
log_median_storey                            -0.046616068
log_total_remaining_lease                     0.004644186
resale_price                                 -0.084728010
log_years_since_lease_commence                0.091914221
log_floor_area_sqm                           -0.017896573
                               log_schools_within_400m log_median_storey
log_distance_to_eldercare                   0.01367672       -0.09484416
log_distance_to_cbd                         0.09870777       -0.19613562
log_distance_to_hawker                      0.01876348       -0.12826378
log_distance_to_mall                       -0.09899597       -0.02402866
log_distance_to_mrt                        -0.21718809       -0.05710699
log_distance_to_parks                       0.04209526       -0.07333640
log_preschools_within_400m                  0.27953418       -0.04661607
log_schools_within_400m                     1.00000000       -0.01690392
log_median_storey                          -0.01690392        1.00000000
log_total_remaining_lease                  -0.25783108        0.11000803
resale_price                               -0.21226633        0.37665733
log_years_since_lease_commence              0.36913042       -0.10850119
log_floor_area_sqm                          0.06575264       -0.16608588
                               log_total_remaining_lease resale_price
log_distance_to_eldercare                    0.079828286  -0.23573233
log_distance_to_cbd                          0.247449415  -0.64274729
log_distance_to_hawker                       0.096557208  -0.31634902
log_distance_to_mall                        -0.166755915   0.03439164
log_distance_to_mrt                         -0.005694969  -0.06961408
log_distance_to_parks                        0.199231472  -0.21187028
log_preschools_within_400m                   0.004644186  -0.08472801
log_schools_within_400m                     -0.257831083  -0.21226633
log_median_storey                            0.110008033   0.37665733
log_total_remaining_lease                    1.000000000   0.22722493
resale_price                                 0.227224926   1.00000000
log_years_since_lease_commence              -0.940797181  -0.29619826
log_floor_area_sqm                          -0.624374748  -0.02192839
                               log_years_since_lease_commence
log_distance_to_eldercare                         -0.02964141
log_distance_to_cbd                               -0.18218299
log_distance_to_hawker                            -0.04537941
log_distance_to_mall                               0.10223651
log_distance_to_mrt                               -0.07614947
log_distance_to_parks                             -0.19507058
log_preschools_within_400m                         0.09191422
log_schools_within_400m                            0.36913042
log_median_storey                                 -0.10850119
log_total_remaining_lease                         -0.94079718
resale_price                                      -0.29619826
log_years_since_lease_commence                     1.00000000
log_floor_area_sqm                                 0.53335781
                               log_floor_area_sqm
log_distance_to_eldercare             -0.06125089
log_distance_to_cbd                   -0.08959270
log_distance_to_hawker                 0.00454388
log_distance_to_mall                   0.17574660
log_distance_to_mrt                    0.17968229
log_distance_to_parks                 -0.03412657
log_preschools_within_400m            -0.01789657
log_schools_within_400m                0.06575264
log_median_storey                     -0.16608588
log_total_remaining_lease             -0.62437475
resale_price                          -0.02192839
log_years_since_lease_commence         0.53335781
log_floor_area_sqm                     1.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Visualize the correlation matrix (optional)</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>, <span class="at">title =</span> <span class="st">"Correlation Matrix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Missing values in numeric columns are imputed with the median to ensure completeness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values in numerical columns with the median</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> joined_data <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="fu">median</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(joined_data, <span class="st">"data/rds/joined_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/rds/joined_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="splitting-to-training-and-test-dataset" class="level1">
<h1>5. SPLITTING TO TRAINING AND TEST DATASET</h1>
<p>The dataset is split into training and testing sets with a 65/35 proportion, where 65% of the data is used for training the model, and 35% is reserved for testing its performance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>resale_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(joined_data, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prop =</span> <span class="fl">6.5</span><span class="sc">/</span><span class="dv">10</span>,)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(resale_split)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(resale_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="non-spatial-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="non-spatial-linear-regression">5.1 Non-Spatial Linear Regression</h2>
<p>This non-spatial linear regression model (<code>price_mlr</code>) aims to predict HDB resale prices using log-transformed distance variables and property characteristics as predictors. The model shows that several factors—such as distance to the hawker, CBD, MRT, parks, the median storey and years since commencement date—are significant predictors of resale prices. With an adjusted R-squared of 0.6369, the model explains approximately 63% of the variance in resale prices, which we can assume to be a moderately strong fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correct model formula with + between variables</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>price_mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  resale_price <span class="sc">~</span> log_distance_to_eldercare <span class="sc">+</span> log_distance_to_cbd <span class="sc">+</span> log_distance_to_hawker <span class="sc">+</span> log_distance_to_mall <span class="sc">+</span> log_distance_to_mrt <span class="sc">+</span> log_distance_to_parks <span class="sc">+</span> log_preschools_within_400m <span class="sc">+</span> log_schools_within_400m <span class="sc">+</span> log_median_storey <span class="sc">+</span> log_years_since_lease_commence,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the model summary</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(price_mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = resale_price ~ log_distance_to_eldercare + log_distance_to_cbd + 
    log_distance_to_hawker + log_distance_to_mall + log_distance_to_mrt + 
    log_distance_to_parks + log_preschools_within_400m + log_schools_within_400m + 
    log_median_storey + log_years_since_lease_commence, data = train_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-282578  -62062  -10030   50086  425063 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                     1621221      31556  51.376  &lt; 2e-16 ***
log_distance_to_eldercare        -16823       9013  -1.867 0.062188 .  
log_distance_to_cbd             -258042       8419 -30.648  &lt; 2e-16 ***
log_distance_to_hawker           -52858      10042  -5.264 1.65e-07 ***
log_distance_to_mall              -7870      13984  -0.563 0.573661    
log_distance_to_mrt              -39001      11697  -3.334 0.000879 ***
log_distance_to_parks            -18520      11573  -1.600 0.109774    
log_preschools_within_400m        11028       6663   1.655 0.098124 .  
log_schools_within_400m           -3560       6262  -0.569 0.569710    
log_median_storey                 44621       4298  10.382  &lt; 2e-16 ***
log_years_since_lease_commence   -95507       4267 -22.382  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 90990 on 1322 degrees of freedom
Multiple R-squared:  0.6396,    Adjusted R-squared:  0.6369 
F-statistic: 234.7 on 10 and 1322 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
</section>
<section id="geographically-weighted-regression" class="level1">
<h1>6. GEOGRAPHICALLY WEIGHTED REGRESSION</h1>
<p>We convert <code>train_data</code> to <code>train_data_sp</code> using <code>as_Spatial</code> to ensure it is in the <code>Spatial</code> format, which is necessary for spatial modeling functions (such as Geographically Weighted Regression) that require spatial data objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>train_data_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(train_data)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>train_data_sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatialPointsDataFrame 
features    : 1333 
extent      : 11755.72, 42441.24, 28457.97, 48339.17  (xmin, xmax, ymin, ymax)
crs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
variables   : 48
names       :            address, postal,   month,       town, flat_type, block,   street_name, storey_range, floor_area_sqm, flat_model, lease_commence_date,    remaining_lease, resale_price, remaining_lease_yr, remaining_lease_mth, ... 
min values  : 102 TECK WHYE LANE, 080109, 2023-01, ANG MO KIO,    5 ROOM,   102,  ADMIRALTY DR,     01 TO 03,            105,       3Gen,                1974, 48 years 11 months,       478000,                 48,                   1, ... 
max values  : 997C BUANGKOK CRES, 824662, 2024-09,     YISHUN,    5 ROOM,  997C, YUNG KUANG RD,     43 TO 45,            142,    Type S2,                2020, 95 years 02 months,      1580000,                 95,                  11, ... </code></pre>
</div>
</div>
<section id="variation-inflation-factor" class="level2">
<h2 class="anchored" data-anchor-id="variation-inflation-factor">6.1 Variation Inflation Factor</h2>
<p>This code uses the Variance Inflation Factor (VIF) to check for multicollinearity in the global regression model predicting <code>resale_price</code>. The VIF values for each predictor in <code>global_model</code> will help identify variables with high collinearity (typically indicated by VIF values greater than 5 or 10).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run VIF on the global model to check for multicollinearity</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>global_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(resale_price <span class="sc">~</span> log_distance_to_eldercare <span class="sc">+</span> log_distance_to_cbd <span class="sc">+</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>                     log_distance_to_hawker <span class="sc">+</span> log_distance_to_mall <span class="sc">+</span> </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                     log_distance_to_mrt <span class="sc">+</span> log_distance_to_parks <span class="sc">+</span> </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                     log_preschools_within_400m <span class="sc">+</span> log_schools_within_400m <span class="sc">+</span> </span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                     log_median_storey <span class="sc">+</span> log_years_since_lease_commence <span class="sc">+</span> </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                     log_floor_area_sqm, </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> train_data_sp)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(global_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     log_distance_to_eldercare            log_distance_to_cbd 
                      1.143913                       1.553793 
        log_distance_to_hawker           log_distance_to_mall 
                      1.162686                       1.271381 
           log_distance_to_mrt          log_distance_to_parks 
                      1.275896                       1.249487 
    log_preschools_within_400m        log_schools_within_400m 
                      1.197455                       1.331544 
             log_median_storey log_years_since_lease_commence 
                      1.084904                       1.820063 
            log_floor_area_sqm 
                      1.577425 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on these VIF results, there is no indication of multicollinearity among the predictors, as all VIF values are below 2. None of the variables are excessively correlated with each other, supporting the model’s stability and interpretability.</p>
</div>
</div>
</section>
<section id="calculation-the-adaptive-bandwidth" class="level2">
<h2 class="anchored" data-anchor-id="calculation-the-adaptive-bandwidth">6.2 Calculation the Adaptive Bandwidth</h2>
<p>This code determines the optimal adaptive bandwidth (<code>bw_adaptive</code>) for a Geographically Weighted Regression (GWR) model that predicts <code>resale_price</code> using various log-transformed distance and property variables. Using cross-validation (<code>approach = "CV"</code>) with a Gaussian kernel, the code adjusts the bandwidth based on local data density, which allows the model to account for spatial variation more accurately. The <code>longlat = FALSE</code> parameter specifies planar distance calculations, aligning with Singapore’s SVY21 coordinate system. This adaptive bandwidth helps capture local effects more effectively across different data densities within the region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  resale_price <span class="sc">~</span> log_distance_to_eldercare <span class="sc">+</span> log_distance_to_cbd <span class="sc">+</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    log_distance_to_hawker <span class="sc">+</span> log_distance_to_mall <span class="sc">+</span> log_distance_to_mrt <span class="sc">+</span> </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    log_distance_to_parks <span class="sc">+</span> log_preschools_within_400m <span class="sc">+</span> </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    log_schools_within_400m <span class="sc">+</span> log_median_storey <span class="sc">+</span> </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>    log_years_since_lease_commence <span class="sc">+</span> log_floor_area_sqm,</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data_sp,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">approach =</span> <span class="st">"CV"</span>,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"gaussian"</span>,</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">longlat =</span> <span class="cn">FALSE</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Adaptive bandwidth: 831 CV score: 8.932964e+12 
Adaptive bandwidth: 522 CV score: 8.41404e+12 
Adaptive bandwidth: 329 CV score: 7.703818e+12 
Adaptive bandwidth: 212 CV score: 7.123606e+12 
Adaptive bandwidth: 137 CV score: 6.550046e+12 
Adaptive bandwidth: 93 CV score: 5.478943e+12 
Adaptive bandwidth: 63 CV score: 4.719272e+12 
Adaptive bandwidth: 47 CV score: 4.274398e+12 
Adaptive bandwidth: 35 CV score: 1.772664e+14 
Adaptive bandwidth: 52 CV score: 4.421058e+12 
Adaptive bandwidth: 41 CV score: 4.117524e+12 
Adaptive bandwidth: 40 CV score: 4.096406e+12 
Adaptive bandwidth: 36 CV score: 1.721515e+14 
Adaptive bandwidth: 39 CV score: 4.075386e+12 
Adaptive bandwidth: 42 CV score: 4.162362e+12 
Adaptive bandwidth: 41 CV score: 4.117524e+12 
Adaptive bandwidth: 42 CV score: 4.162362e+12 
Adaptive bandwidth: 41 CV score: 4.117524e+12 
Adaptive bandwidth: 41 CV score: 4.117524e+12 
Adaptive bandwidth: 40 CV score: 4.096406e+12 
Adaptive bandwidth: 40 CV score: 4.096406e+12 
Adaptive bandwidth: 39 CV score: 4.075386e+12 </code></pre>
</div>
</div>
</section>
<section id="calculating-the-gwr" class="level2">
<h2 class="anchored" data-anchor-id="calculating-the-gwr">6.3 Calculating the GWR</h2>
<p>This code chunk below runs an adaptive Geographically Weighted Regression (GWR) model (<code>gwr_adaptive</code>) to predict <code>resale_price</code> using various log-transformed distance and property characteristics. The model applies the optimal adaptive bandwidth (<code>bw_adaptive</code>) calculated previously. A Gaussian kernel is used to assign weights, and <code>adaptive=TRUE</code> enables the model to capture local spatial variations more accurately. With <code>longlat = FALSE</code>, distances are calculated in planar units, suitable for the SVY21 projection system. This GWR model helps reveal how the influence of each variable changes across different locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span>log_distance_to_eldercare <span class="sc">+</span> log_distance_to_cbd <span class="sc">+</span> log_distance_to_hawker <span class="sc">+</span> log_distance_to_mall <span class="sc">+</span> log_distance_to_mrt <span class="sc">+</span> log_distance_to_parks <span class="sc">+</span> log_preschools_within_400m <span class="sc">+</span> log_schools_within_400m <span class="sc">+</span> log_median_storey <span class="sc">+</span> log_years_since_lease_commence <span class="sc">+</span> log_floor_area_sqm,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>train_data_sp,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bw=</span>bw_adaptive, </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This output summarizes the results of the Geographically Weighted Regression (GWR) model for predicting HDB resale prices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ***********************************************************************
   *                       Package   GWmodel                             *
   ***********************************************************************
   Program starts at: 2024-11-10 23:50:32.110838 
   Call:
   gwr.basic(formula = resale_price ~ log_distance_to_eldercare + 
    log_distance_to_cbd + log_distance_to_hawker + log_distance_to_mall + 
    log_distance_to_mrt + log_distance_to_parks + log_preschools_within_400m + 
    log_schools_within_400m + log_median_storey + log_years_since_lease_commence + 
    log_floor_area_sqm, data = train_data_sp, bw = bw_adaptive, 
    kernel = "gaussian", adaptive = TRUE, longlat = FALSE)

   Dependent (y) variable:  resale_price
   Independent variables:  log_distance_to_eldercare log_distance_to_cbd log_distance_to_hawker log_distance_to_mall log_distance_to_mrt log_distance_to_parks log_preschools_within_400m log_schools_within_400m log_median_storey log_years_since_lease_commence log_floor_area_sqm
   Number of data points: 1333
   ***********************************************************************
   *                    Results of Global Regression                     *
   ***********************************************************************

   Call:
    lm(formula = formula, data = data)

   Residuals:
    Min      1Q  Median      3Q     Max 
-250771  -52071   -4361   38963  357278 

   Coefficients:
                                  Estimate Std. Error t value Pr(&gt;|t|)    
   (Intercept)                    -2442411     253217  -9.646  &lt; 2e-16 ***
   log_distance_to_eldercare         -3692       8279  -0.446  0.65568    
   log_distance_to_cbd             -258594       7697 -33.598  &lt; 2e-16 ***
   log_distance_to_hawker           -58742       9187  -6.394 2.24e-10 ***
   log_distance_to_mall             -18410      12800  -1.438  0.15059    
   log_distance_to_mrt              -74777      10920  -6.848 1.15e-11 ***
   log_distance_to_parks            -30087      10604  -2.837  0.00462 ** 
   log_preschools_within_400m         9205       6092   1.511  0.13103    
   log_schools_within_400m            8258       5770   1.431  0.15267    
   log_median_storey                 53080       3964  13.392  &lt; 2e-16 ***
   log_years_since_lease_commence  -135970       4636 -29.330  &lt; 2e-16 ***
   log_floor_area_sqm               878407      54380  16.153  &lt; 2e-16 ***

   ---Significance stars
   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
   Residual standard error: 83180 on 1321 degrees of freedom
   Multiple R-squared: 0.6991
   Adjusted R-squared: 0.6966 
   F-statistic:   279 on 11 and 1321 DF,  p-value: &lt; 2.2e-16 
   ***Extra Diagnostic information
   Residual sum of squares: 9.139144e+12
   Sigma(hat): 82863.59
   AIC:  33999.21
   AICc:  33999.48
   BIC:  32827.28
   ***********************************************************************
   *          Results of Geographically Weighted Regression              *
   ***********************************************************************

   *********************Model calibration information*********************
   Kernel function: gaussian 
   Adaptive bandwidth: 39 (number of nearest neighbours)
   Regression points: the same locations as observations are used.
   Distance metric: Euclidean distance metric is used.

   ****************Summary of GWR coefficient estimates:******************
                                         Min.     1st Qu.      Median
   Intercept                      -34803840.0  -3360645.6  -1636492.8
   log_distance_to_eldercare        -418185.5    -49333.7    -10088.8
   log_distance_to_cbd             -5533860.0   -505069.0   -194637.3
   log_distance_to_hawker           -237886.7   -106812.7    -45726.0
   log_distance_to_mall            -1189176.0   -184674.6    -88906.3
   log_distance_to_mrt              -693260.5   -135518.0    -89237.7
   log_distance_to_parks            -416260.4    -57750.3     -1313.4
   log_preschools_within_400m        -33928.9      5040.9     18704.3
   log_schools_within_400m          -481297.2    -27318.9    -10374.2
   log_median_storey                  21007.9     37545.5     46342.6
   log_years_since_lease_commence   -349747.1   -167067.2   -118881.5
   log_floor_area_sqm              -1383666.8    339302.2    659435.8
                                      3rd Qu.     Max.
   Intercept                         390064.8 14286908
   log_distance_to_eldercare          40937.1   362162
   log_distance_to_cbd               -30425.0  4218732
   log_distance_to_hawker             -1851.5   498861
   log_distance_to_mall              -24852.6   141354
   log_distance_to_mrt               -32354.0  1409540
   log_distance_to_parks              91315.8  1207914
   log_preschools_within_400m         34855.2   110610
   log_schools_within_400m             8868.4   632075
   log_median_storey                  56008.4    90076
   log_years_since_lease_commence    -86020.2    37225
   log_floor_area_sqm               1050782.3  5912195
   ************************Diagnostic information*************************
   Number of data points: 1333 
   Effective number of parameters (2trace(S) - trace(S'S)): 220.6678 
   Effective degrees of freedom (n-2trace(S) + trace(S'S)): 1112.332 
   AICc (GWR book, Fotheringham, et al. 2002, p. 61, eq 2.33): 32907.62 
   AIC (GWR book, Fotheringham, et al. 2002,GWR p. 96, eq. 4.22): 32666.73 
   BIC (GWR book, Fotheringham, et al. 2002,GWR p. 61, eq. 2.34): 32454.94 
   Residual sum of squares: 2.994256e+12 
   R-square value:  0.9014108 
   Adjusted R-square value:  0.8818348 

   ***********************************************************************
   Program stops at: 2024-11-10 23:50:33.136128 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some observations:</p>
<ol type="1">
<li><p><strong>Global Regression Results</strong>: The global model shows an adjusted R-squared of 0.6958, explaining around 70% of the variance in resale prices with significant predictors including distances to CBD, hawkers, MRT stations, parks, and property characteristics like storey level, lease age, and floor area sqm.</p></li>
<li><p><strong>GWR Model Performance</strong>: The GWR model, with an adaptive bandwidth that uses 34 nearest neighbors, demonstrates improved performance with an R-squared of 0.9374, indicating that the model explains around 94% of the variance in resale prices when accounting for spatial variation. The diagnostic metrics (AICc, AIC, and BIC) suggest a better model fit compared to the global regression.</p></li>
<li><p><strong>Spatial Variation in Coefficients</strong>: The GWR coefficients vary across locations, as shown in the summary with ranges for each predictor. This variation reflects the differing influence of factors like proximity to parks and lease duration across different areas, which highlights the model’s ability to capture local effects.</p></li>
</ol>
</div>
</div>
</section>
<section id="testing" class="level2">
<h2 class="anchored" data-anchor-id="testing">6.4 Testing</h2>
<p>Next, in the code chunk below we convert <code>test_data</code> to <code>test_data_sp</code> using <code>as_Spatial</code> to ensure it is in the <code>Spatial</code> format, which is necessary for spatial modeling functions (such as Geographically Weighted Regression) that require spatial data objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>test_data_sp <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_Spatial</span>()</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>test_data_sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatialPointsDataFrame 
features    : 719 
extent      : 11755.72, 42441.24, 28457.97, 48339.17  (xmin, xmax, ymin, ymax)
crs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
variables   : 48
names       :            address, postal,   month,       town, flat_type, block,     street_name, storey_range, floor_area_sqm, flat_model, lease_commence_date,    remaining_lease, resale_price, remaining_lease_yr, remaining_lease_mth, ... 
min values  :     101 SIMEI ST 1, 080109, 2023-01, ANG MO KIO,    5 ROOM,   101, ANCHORVALE CRES,     01 TO 03,            104,       3Gen,                1974, 49 years 10 months,       470000,                 49,                   1, ... 
max values  : 997C BUANGKOK CRES, 824662, 2024-09,     YISHUN,    5 ROOM,  997C,   YUNG KUANG RD,     46 TO 48,            150,    Type S2,                2020, 95 years 05 months,      1588000,                 95,                  11, ... </code></pre>
</div>
</div>
</section>
<section id="gwr---test-data" class="level2">
<h2 class="anchored" data-anchor-id="gwr---test-data">6.5 GWR - Test Data</h2>
<p>The code chunk below uses the <code>gwr.predict</code> function to apply a Geographically Weighted Regression (GWR) model, predicting <code>resale_price</code> in the test dataset (<code>test_data_sp</code>) based on spatial relationships observed in the training dataset (<code>train_data_sp</code>). It uses an adaptive bandwidth (<code>bw_adaptive</code>), a Gaussian kernel, and planar distances (<code>longlat = FALSE</code>) to account for local variations in predictor influence across the region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>gwr_pred <span class="ot">&lt;-</span> <span class="fu">gwr.predict</span>(</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> resale_price <span class="sc">~</span> log_distance_to_eldercare <span class="sc">+</span> log_distance_to_cbd <span class="sc">+</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>             log_distance_to_hawker <span class="sc">+</span> log_distance_to_mall <span class="sc">+</span> log_distance_to_mrt <span class="sc">+</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>             log_distance_to_parks <span class="sc">+</span> log_preschools_within_400m <span class="sc">+</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>             log_schools_within_400m <span class="sc">+</span> log_median_storey <span class="sc">+</span> </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>             log_years_since_lease_commence <span class="sc">+</span> log_floor_area_sqm, </span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data_sp, </span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictdata =</span> test_data_sp, </span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> bw_adaptive,</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">kernel =</span> <span class="st">"gaussian"</span>, </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adaptive =</span> <span class="cn">TRUE</span>,  </span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">longlat =</span> <span class="cn">FALSE</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code extracts spatial coordinates from <code>joined_data</code>, <code>train_data</code>, and <code>test_data</code>, saving them separately as <code>coords</code>, <code>coords_train</code>, and <code>coords_test</code>. It then removes the geometry from <code>train_data</code> and <code>test_data</code> using <code>st_drop_geometry()</code> to make them non-spatial, which is useful for operations or models that don’t require spatial data. The <code>coords_test</code> is combined back with <code>test_data</code> as non-spatial columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(joined_data)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(train_data)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, coords_test) <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code <code>head(gwr_pred$SDF@data)</code> displays the first few rows of the data frame portion of the <code>SDF</code> object within <code>gwr_pred</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gwr_pred<span class="sc">$</span>SDF<span class="sc">@</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Intercept_coef log_distance_to_eldercare_coef log_distance_to_cbd_coef
1      -447005.5                      46928.083                -31446.33
2      -447005.5                      46928.083                -31446.33
3     -1969741.2                     104764.705               -282407.41
4     -3854089.0                     -62356.912                317273.82
5     -1871725.6                      -9015.912               -314148.13
6     -1871725.6                      -9015.912               -314148.13
  log_distance_to_hawker_coef log_distance_to_mall_coef
1                   -62297.41                 -62052.32
2                   -62297.41                 -62052.32
3                   -83623.86                -136695.82
4                  -213623.70                -148397.40
5                   -82720.25                 -72235.02
6                   -82720.25                 -72235.02
  log_distance_to_mrt_coef log_distance_to_parks_coef
1               -170913.97                  -69052.77
2               -170913.97                  -69052.77
3                 34928.72                 -105852.31
4                -22068.47                   84998.40
5               -132368.86                  -35269.88
6               -132368.86                  -35269.88
  log_preschools_within_400m_coef log_schools_within_400m_coef
1                        34677.68                   -38244.957
2                        34677.68                   -38244.957
3                        23391.68                   -25929.534
4                        26132.99                    -7489.214
5                       -33928.91                     5429.789
6                       -33928.91                     5429.789
  log_median_storey_coef log_years_since_lease_commence_coef
1               59600.59                          -161789.97
2               59600.59                          -161789.97
3               50987.70                           -97954.03
4               39811.39                          -122039.99
5               61543.24                          -161465.91
6               61543.24                          -161465.91
  log_floor_area_sqm_coef prediction prediction_var
1                375575.8   718578.6     3151530689
2                375575.8   700690.7     3089844684
3                768174.6   578033.2     3192560509
4                861718.5   565676.4     3028393313
5                840838.9   711916.8     2817099966
6                840838.9   707884.4     2804542824</code></pre>
</div>
</div>
<section id="comparing-actual-values-to-predicted-values-using-a-scatterplot" class="level3">
<h3 class="anchored" data-anchor-id="comparing-actual-values-to-predicted-values-using-a-scatterplot">COMPARING ACTUAL VALUES TO PREDICTED VALUES USING A SCATTERPLOT</h3>
<p>This code manually computes predicted <code>resale_price</code> values for each observation in the test dataset, using spatially varying coefficients from a Geographically Weighted Regression (GWR) model.</p>
<p>First, it extracts the coefficient estimates stored within the GWR object (<code>gwr_pred$SDF@data</code>) and converts the spatial <code>test_data_sp</code> dataset into a regular data frame for easier processing. The prediction calculation combines the intercept and each log-transformed predictor, multiplied by its corresponding coefficient, to generate spatially adjusted predictions for resale prices across the dataset. This approach considers local variations for each predictor, as GWR models allow coefficients to vary by location.</p>
<p>Next, the code creates a new data frame to compare the actual and predicted resale prices. Using <code>ggplot2</code>, it generates a scatter plot where each point represents an HDB property, with actual prices on the y-axis and predicted prices on the x-axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients and test data as data frames</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> gwr_pred<span class="sc">$</span>SDF<span class="sc">@</span>data</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>test_data_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(test_data_sp)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the predicted values manually</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>predicted_values <span class="ot">&lt;-</span> coefficients<span class="sc">$</span>Intercept_coef <span class="sc">+</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_distance_to_eldercare_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_distance_to_eldercare <span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_distance_to_cbd_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_distance_to_cbd <span class="sc">+</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_distance_to_hawker_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_distance_to_hawker <span class="sc">+</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_distance_to_mall_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_distance_to_mall <span class="sc">+</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_distance_to_mrt_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_distance_to_mrt <span class="sc">+</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_distance_to_parks_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_distance_to_parks <span class="sc">+</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_preschools_within_400m_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_preschools_within_400m <span class="sc">+</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_schools_within_400m_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_schools_within_400m <span class="sc">+</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_median_storey_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_median_storey <span class="sc">+</span></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_years_since_lease_commence_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_years_since_lease_commence <span class="sc">+</span></span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>  coefficients<span class="sc">$</span>log_floor_area_sqm_coef <span class="sc">*</span> test_data_df<span class="sc">$</span>log_floor_area_sqm</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a comparison data frame</span></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> test_data_sp<span class="sc">$</span>resale_price,</span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> predicted_values</span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the actual vs. predicted values</span></span>
<span id="cb122-26"><a href="#cb122-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb122-27"><a href="#cb122-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Predicted, <span class="at">y =</span> Actual)) <span class="sc">+</span></span>
<span id="cb122-28"><a href="#cb122-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb122-29"><a href="#cb122-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Actual vs Predicted Resale Prices"</span>,</span>
<span id="cb122-30"><a href="#cb122-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Predicted Resale Price"</span>,</span>
<span id="cb122-31"><a href="#cb122-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Actual Resale Price"</span>) <span class="sc">+</span></span>
<span id="cb122-32"><a href="#cb122-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is important to note that points that closely follow the 45-degree line indicate strong predictive performance. Deviations suggest areas where the model may need refinement.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The scatter plot shows a generally positive correlation between actual and predicted resale prices, meaning the model captures the trend in resale prices to some extent. However, there is noticeable dispersion from the 45-degree line, especially at higher price ranges, where the model tends to underpredict or overpredict actual values. This suggests that while the GWR model performs reasonably well for mid-range prices, it struggles with accuracy at the extremes of the price distribution.</p>
</div>
</div>
<p>After 1.5 days, the GWRF model is still running and has not completed. Consequently, this analysis relies solely on the Geographically Weighted Regression (GWR) model and a non-spatial linear regression model, as the extended processing time for GWRF has made it impractical to include in the current analysis.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>